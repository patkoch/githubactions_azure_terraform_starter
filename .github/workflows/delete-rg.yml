on: workflow_dispatch
name: destroy-resource-group
jobs:
  destroy-resources:
    runs-on: ubuntu-latest
    steps:
      - name : Checkout the repository
        uses: actions/checkout@v3
      - name: List files in the repository
        run: ls -R
      - name: Login with Service Principal
        run: |
          az login --service-principal -u ${{ secrets.CLIENT_ID }} -p ${{ secrets.CLIENT_SECRET }} --tenant ${{ secrets.TENANT_ID }}
      - name: Conduct Terraform init
        run: |
          export ARM_CLIENT_ID=${{ secrets.CLIENT_ID }}
          export ARM_CLIENT_SECRET=${{ secrets.CLIENT_SECRET }}
          export ARM_TENANT_ID=${{ secrets.TENANT_ID }}
          export ARM_SUBSCRIPTION_ID=${{ secrets.SUBSCRIPTION_ID }}
          terraform init
      - name: Conduct Terraform destroy
        run: |
          export ARM_CLIENT_ID=${{ secrets.CLIENT_ID }}
          export ARM_CLIENT_SECRET=${{ secrets.CLIENT_SECRET }}
          export ARM_TENANT_ID=${{ secrets.TENANT_ID }}
          export ARM_SUBSCRIPTION_ID=${{ secrets.SUBSCRIPTION_ID }}
          terraform destroy -auto-approve
      
